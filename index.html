<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="x-ogp-key" content="YOUR_API_KEY_HERE" />
<title>Flappy Bird - PlayFun</title>

<style>
body { margin:0; overflow:hidden; background:#70c5ce; }
canvas { display:block; margin:auto; background:#70c5ce; }

#resetBtn{
position:absolute;
top:20px;
right:20px;
padding:10px 20px;
font-size:16px;
background:#ffcc00;
border:none;
border-radius:6px;
}
</style>

<script src="https://sdk.play.fun"></script>
</head>

<body>

<canvas id="gameCanvas" width="400" height="600"></canvas>
<button id="resetBtn">RESET</button>

<script>
/* ========= SDK INIT ========= */
let sdk = new OpenGameSDK({ ui:{ usePointsWidget:true }});
let sdkReady = false;

sdk.init({ gameId:"YOUR_GAME_ID_HERE"}).then(()=>{
    sdkReady = true;
});

/* ========= SETUP ========= */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const resetBtn = document.getElementById("resetBtn");

let gameOver = false;
let score = 0;

/* ========= SOUND ========= */
const flapSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
const hitSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

/* ========= BIRD ========= */
let bird = {
x:80,
y:300,
width:34,
height:24,
velocity:0,
gravity:0.5,
lift:-8,
frame:0
};

/* ========= PIPES ========= */
let pipes=[];
let pipeGap=150;
let pipeWidth=60;

function createPipe(){
let topHeight=Math.random()*250+50;
pipes.push({
x:400,
top:topHeight,
bottom:600-topHeight-pipeGap
});
}

setInterval(()=>{
if(!gameOver) createPipe();
},1500);

/* ========= DRAW FUNCTIONS ========= */
function drawBackground(){
ctx.fillStyle="#70c5ce";
ctx.fillRect(0,0,400,600);

ctx.fillStyle="#ded895";
ctx.fillRect(0,550,400,50);
}

function drawBird(){
ctx.save();
ctx.translate(bird.x+bird.width/2,bird.y+bird.height/2);
ctx.rotate(bird.velocity*0.05);

ctx.fillStyle="yellow";
ctx.beginPath();
ctx.ellipse(0,0,18,12,0,0,Math.PI*2);
ctx.fill();

ctx.fillStyle="white";
ctx.beginPath();
ctx.arc(8,-4,4,0,Math.PI*2);
ctx.fill();

ctx.restore();
}

function drawPipes(){
ctx.fillStyle="green";
pipes.forEach(pipe=>{
ctx.fillRect(pipe.x,0,pipeWidth,pipe.top);
ctx.fillRect(pipe.x,600-pipe.bottom,pipeWidth,pipe.bottom);
});
}

/* ========= UPDATE ========= */
function update(){
if(gameOver) return;

bird.velocity+=bird.gravity;
bird.y+=bird.velocity;

pipes.forEach(pipe=>{
pipe.x-=2;

if(pipe.x+pipeWidth===bird.x){
score++;
if(sdkReady) sdk.addPoints(1);
}

if(
bird.x<pipe.x+pipeWidth &&
bird.x+bird.width>pipe.x &&
(bird.y<pipe.top || bird.y+bird.height>600-pipe.bottom)
){
endGame();
}
});

if(bird.y+bird.height>550 || bird.y<0){
endGame();
}
}

/* ========= DRAW ========= */
function draw(){
ctx.clearRect(0,0,400,600);
drawBackground();
drawPipes();
drawBird();

ctx.fillStyle="white";
ctx.font="28px Arial";
ctx.fillText("Score: "+score,20,50);

if(gameOver){
ctx.font="40px Arial";
ctx.fillText("GAME OVER",70,300);
}
}

/* ========= LOOP ========= */
function loop(){
update();
draw();
requestAnimationFrame(loop);
}
loop();

/* ========= CONTROLS ========= */
function flap(){
if(gameOver) return;
bird.velocity=bird.lift;
flapSound.play();
}

function endGame(){
gameOver=true;
hitSound.play();
if(sdkReady) sdk.endGame();
}

function resetGame(){
bird.y=300;
bird.velocity=0;
pipes=[];
score=0;
gameOver=false;
}

document.addEventListener("keydown",e=>{
if(e.code==="Space") flap();
});

canvas.addEventListener("click",flap);
resetBtn.addEventListener("click",resetGame);
</script>

</body>
</html>